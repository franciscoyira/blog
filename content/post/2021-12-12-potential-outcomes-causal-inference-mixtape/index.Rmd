---
title: Potential Outcomes Model (or why correlation is not causality)
author: Francisco Yir치
date: '2021-12-12'
slug: potential-outcomes-causal-inference-mixtape
cover: "images/homer_potential_outcomes.jpg"
useRelativeCover: true
isMath: "true"
categories:
  - books
  - causal-inference
  - data-science
tags:
  - causal-inference-the-mixtape
  - summaries
  - potential-outcomes
---

This article, the second one of [the series](https://www.franciscoyira.com/tags/causal-inference-the-mixtape/) about the book [Causal Inference: The Mixtape](https://mixtape.scunning.com/), is all about the Potential Outcomes notation and how it enables us to tackle causality questions and understand key concepts in this field[^1].

[^1]: The potential outcomes notation was first introduced by [Splawa-Neymanen in 1923](https://www.jstor.org/stable/2245382), and then was popularized [by Rubin since 1974]((https://www.fsb.muohio.edu/lij14/420_paper_Rubin74.pdf)).

The central idea of this notation is the **comparison between 2 states of the world**:

- **The actual state**: the outcomes observed in the data given the real value taken by some treatment variable. For example, the quarterly sales of a company given that they did some marketing campaign.

-   **The counterfactual state:** what would have happened if the treatment variable had taken another value. For example, the quarterly sales of the company if the marketing campaign had not been carried out.

The **causal effect** of an intervention (in this case, the marketing campaign) is the difference in the outcome variable between these two states. Thus, to calculate it, it would suffice to do a subtraction between them... but we can't actually do that because **the counterfactual value is hypothetical and unknown**. Counterfactuals don't really exist because as soon as one of the possible scenarios materializes, then all the other potential outcomes disappear.

In the company example, when the marketing campaign is carried out, it is no longer possible to know how much would have been the sales if the campaign had been ditched. We can have hypotheses or guesses, but we will never know for sure the counterfactual value for this individual company.

The good news is that by having data for many companies (and when some special conditions are met) we can still get a reasonable **estimate** for the **average effect** of a generic marketing campaign over that *group* of companies.

## Potential outcomes notation

Now we will translate those concepts into the potential outcomes notation.

First, we define the variable $D_i$, which represents if the unit $i$ receives the treatment or not[^2]. In the previous example, this variable would take the value 1 if the company $i$ executes the marketing campaign and 0 if not.

[^2]: There are cases where the treatment is not binary, but they will be left out of this article in order to keep the explanations simple.

Then we define the variable $Y_i$, which represents **the outcome of interest** for the unit $i$ (let's say, the quarterly sales of the company $i$).

This outcome variable can also have a superindex, which usually takes values 0 or 1 and indicates to which value of $D$ is the outcome associated. In our example, the superindex tells us if the outcome (sales) corresponds to a world where the company $i$ implemented the marketing campaign ($Y_i^1$) or to one where it didn't ($Y_i^0$).

It's important to note that the superindex by itself ***does not*** tell us if the outcome is actual or counterfactual. To know if an outcome is counterfactual or not, we need an additional piece of notation:

$$
Y_i^1|D_i=0
$$

[CONTINUAR AC츼]

Ahora esta se interpreta como "las ventas de la empresa $i$ cuando s칤 se realiza la campa침a de marketing, *condicional a que no realiz칩 la campa침a de marketing en realidad*".

En otras palabras, el super칤ndice denota un escenario hipot칠tico para $Y_i$, y lo que viene despu칠s de $|$ denota lo que ocurri칩 realmente con la unidad $i$. Si estos valores coinciden, estamos frente a un outcome "real", y si son distintos, se trata de un outcome "contrafactual" (y por ende desconocido).

Una forma de resumir lo anterior es la llamada ***switching equation***:

$$
Y_i = D_iY_i^1+(1-D_i)Y_i^0
$$

Que puede entenderse mejor con la ayuda de este meme:

![*Meme ~~robado~~ prestado del libro [Causal Inference for the Brave and True](https://matheusfacure.github.io/python-causality-handbook/01-Introduction-To-Causality.html)*](images/meme_potential_outcomes.jpg){width="400"}

La idea aqu칤 es que en el mundo real observamos s칩lo el outcome real ($Y_i$) que corresponde a la materializaci칩n de uno de los dos outcomes potenciales ($Y_i^1, Y_i^0$) en base al valor tomado por $D_i$: si $D_i=1$, entonces $1-D_i=0$ y la ecuaci칩n colapsa a $Y_i=Y_i^1$ (y viceversa cuando $D_i=0$).

![](images/switching%20equation%20explicada.png){width="500"}

El outcome potencial no materializado queda relegado a ser el *contrafactual* (i.e. una entelequia de nuestra imaginaci칩n).

Con estos elementos ya podemos tambi칠n definir el **efecto causal** de la campa침a de marketing para la empresa $i$ (la diferencia entre *las ventas si se hubiera realizado la campa침a* y *las ventas si no se hubiera realizado la campa침a*).

$$
\delta_i=Y_i^1-Y_i^0
$$

Como solo conocemos uno de los 2 outcomes potenciales para la unidad $i$, el valor $\delta_i$ es imposible de observar. Adem치s, notar que la presencia del sub칤ndice $i$ implica que el efecto causal puede ser distinto para otras unidades (en general, $\delta_i\ne\delta_j$).

## Efectos promedio: ATE y ATT

Si bien nunca podemos conocer los efectos del tratamiento para cada unidad, bajo ciertas circunstancias podemos estimar efectos causales promedio para un conjunto de unidades.

Existen varios nombres para estos efectos promedio, dependiendo de qu칠 conjunto de unidades se considere. Los m치s relevantes son:

-   [**A**]{.ul}**verage [T]{.ul}reatment [E]{.ul}ffect (ATE):** Corresponde al efecto promedio sobre todas las unidades.

$$
\begin{aligned}
ATE &= E[\delta_i]\\
&= E[Y_i^1 - Y_i^0]\\
&= E[Y_i^1]-E[Y_i^0]
\end{aligned}
$$

-   [**A**]{.ul}**verage [T]{.ul}reatment Effect on the [T]{.ul}reated (ATT):** Similar al ATE, pero s칩lo considera las unidades que efectivamente recibieron el tratamiento ($|D_i=1$)[^3].

[^3]: Adem치s existe el ATU, que es an치logo al ATT pero considerando s칩lo las unidades que *no* recibieron el tratamiento. Es menos relevante que el ATE y el ATT y por eso lo menciono solo en una nota al pie.

$$
\begin{aligned}
ATT &= E[\delta_i|D_i=1]\\
&= E[Y_i^1 - Y_i^0|D_i=1]\\
&= E[Y_i^1|D_i=1]-E[Y_i^0|D_i=1]
\end{aligned}
$$

Debemos recordar que aunque las unidades reciban el tratamiento, aun as칤 poseen conceptualmente un outcome potencial sin tratamiento ($Y_i^0$). Adem치s, como los efectos $\delta_i$ pueden ser diferentes entre unidades (y generalmente lo son), lo m치s probable es que ATE y ATT sean distintos.

Algo problem치tico aqu칤 es que el ATE y el ATT todav칤a son funciones de t칠rminos contrafactuales, y por ende son imposibles de calcular bajo estas expresiones. Pero antes hab칤amos dicho que en ciertas situaciones era posible estimarlos. 쮺u치les son esas situaciones?

Para explicarlo debemos introducir una nueva expresi칩n que s칤 puede calcularse: la **diferencia simple de outcomes**.

## Diferencia simple de outcomes

A pesar de la relevancia de los outcomes potenciales, el mundo real los 칰nicos valores que observamos son:

-   Los outcomes reales: $Y_i$

-   Los valores de tratamiento de las unidades: $D_i$

Siguiendo con el ejemplo anterior, esto equivaldr칤a a observar:

-   Las ventas de cada empresa

-   Si realizaron una campa침a de marketing o no durante el periodo analizado

Un estad칤stico f치cil de obtener con estos datos es la diferencia en ventas promedio entre las empresas que realizaron una campa침a de marketing y las que no la hicieron. A este estad칤stico le denominaremos SDO (*Simple Difference in Outcomes*), y se expresa as칤 en notaci칩n de potential outcomes:

$$
E[Y^1|D=1] - E[Y^0|D=0]
$$

Y se calcula con la siguiente f칩rmula (donde $N_T$ es la cantidad de empresas con $D=1$ y $N_C$ es la cantidad de empresas con $D=0$).

$$
\frac{1}{N_T} \sum_{i=1}^n(yi|d_i=1)-\frac{1}{N_C}\sum_{i=1}^{n}(y_i|d_i=0)
$$

Puede verse que esta expresi칩n **contiene s칩lo outcomes reales** (observables) por lo que **s칤 se puede calcular**.

Ahora bien, intuitivamente sabemos que atribuirle interpretaci칩n causal a esta cifra est치 mal. Por ejemplo, es probable que las empresas con presupuesto suficiente para hacer una campa침a de marketing sean empresas m치s grandes, y por ende fueran a tener ventas mayores aunque no realizaran la campa침a.

Esta intuici칩n se ve reflejada en la **descomposici칩n de la diferencia simple de outcomes (SDO)**: ![](images/sdo.png)

Lo que nos dice esta descomposici칩n es que el SDO corresponde a la suma de 3 expresiones:

-   Nuestro codiciado **Average Treatment Effect**, el promedio de los efectos causales.

-   Dos sesgos: el **sesgo de selecci칩n** (diferencia de ventas promedio entre los grupos de empresas si es que ninguna hubiera realizado una campa침a de marketing) y el **sesgo de efectos heterog칠neos** (diferencia de los $\delta_i$ promedio entre empresas que realizaron campa침a y las que no).

Esta descomposici칩n [est치 demostrada en el libro](https://mixtape.scunning.com/potential-outcomes.html#simple-difference-in-means-decomposition) y es la explicaci칩n "t칠cnica" de porqu칠 la diferencia de medias usualmente no tiene interpretaci칩n causal: los sesgos de selecci칩n y de efectos heterog칠neos hacen que el SDO sea distinto del ATE.

La descomposici칩n nos entrega buenas y malas noticias. La buena es que tenemos ahora un estad칤stico f치cil de calcular (el SDO) que t칠cnicamente *contiene* el ATE. La mala es que para "extraer" el ATE desde el SDO necesitamos informaci칩n que en el mundo real no tenemos (los sesgos est치n expresados en t칠rminos de potential outcomes).

La luz de esperanza que nos ofrece la inferencia causal ante esto es desarrollar estrategias para que, en los datos recolectados, los sesgos sean peque침os o despreciables, y as칤 sea posible usar el SDO como estimador del ATE.

En palabras de [Scott Cunningham](https://www.scunning.com/), autor del libro:

> "One could argue that the entire enterprise of causal inference is about developing a reasonable strategy for negating the role that selection bias is playing in estimated causal effects."

## El supuesto de independencia (y la efectividad de la randomizaci칩n)

OK, sabemos que queremos recuperar efectos promedio, como el ATE y el ATT, y que el SDO no *generalmente* es un buen estimador de ellos debido a los sesgos ya vistos. 쯇ero qu칠 explica la aparici칩n de estos sesgos?

**Los sesgos** (de selecci칩n y de efectos heterog칠neos) **aparecen cuando la asignaci칩n del tratamiento (**$D_i$**) no es independiente de los outcomes potenciales.**

Por ejemplo, cuando decimos algo como "*las empresas con presupuesto suficiente para hacer una campa침a de marketing son m치s grandes, y por ende tendr치n mayores ventas aunque no realicen la campa침a*" lo que estamos queriendo decir, en lenguaje de outcomes potenciales, es que $D$ depende de $Y^0$: empresas con mayor valor de $Y^0$ tienen mayor probabilidad de mostrar un valor $D=1$.

De lo anterior se desprende que **cuando s칤 existe indepencia entre la asignaci칩n del tratamiento y los outcomes potenciales (**$(Y^1,Y^0)\mathrel{\unicode{x2AEB}}D$**) el SDO s칤 es un buen estimador del ATE!** (es insesgado)[^4].

[^4]: Pueden encontrar una demostraci칩n de esto en [esta secci칩n](https://mixtape.scunning.com/potential-outcomes.html#independence-assumption) del libro.

![](https://media2.giphy.com/media/G96zgIcQn1L2xpmdxi/giphy.gif)

La mala noticia es que esto rara vez ocurre en el mundo real.

![](https://media2.giphy.com/media/nrg0TI3u0BFw5NBDsQ/giphy.gif)

En general, dondequiera que la variable $D$ sea escogida libremente por seres humanos, habr치 dependencia entre $D$ y los outcomes potenciales 游땻. Si bien las personas no somos [*homo economicus*](https://en.wikipedia.org/wiki/Homo_economicus) que toman sus decisiones con informaci칩n perfecta (no conocemos con exactitud los outcomes potenciales), s칤 recabamos informaci칩n sobre las opciones posibles y sus resultados esperados, y tomamos decisiones que creemos que nos beneficiar치n a partir de esa informaci칩n incompleta. Esto es suficiente para que tales decisiones (i.e. los valores de $D$) no sean independientes de los potential outcomes.

En palabras del autor del Mixtape: "*La elecci칩n racional est치 siempre empujando en contra del supuesto de independencia*".

La excepci칩n a esto es la **randomizaci칩n**, justamente porque all칤 no existe elecci칩n libre elecci칩n por parte de agentes. Al asignar los valores de $D$ de forma aleatoria a los participantes de un experimento, imponemos independencia entre estos valores y los outcomes potenciales. Como consecuencia, **la diferencia simple de medias en datos experimentales suele ser suficiente para estimar efectos causales sin sesgo**.
