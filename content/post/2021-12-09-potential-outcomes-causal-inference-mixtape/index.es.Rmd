---
title: Modelo de outcomes potenciales (o porqu칠 correlaci칩n no es causalidad)
author: Francisco Yir치
date: '2021-12-09'
slug: potential-outcomes-causal-inference-mixtape
cover: "images/homer_potential_outcomes.jpg"
useRelativeCover: true
isMath: "true"
categories:
  - libros
  - inferencia-causal
  - data-science
tags:
  - causal-inference-the-mixtape
  - resumenes
  - potential-outcomes
---

En este art칤culo, el segundo de [la serie](https://www.franciscoyira.com/es/tags/causal-inference-the-mixtape/) dedicada al libro [Causal Inference: The Mixtape](https://mixtape.scunning.com/), hablar칠 sobre [**la notaci칩n de *Potential Outcomes***](https://mixtape.scunning.com/potential-outcomes.html) y de c칩mo esta nos permite abordar preguntas de causalidad y entender conceptos claves de este campo[^1].

[^1]: La notaci칩n de Potential Outcomes fue concebida primero por [Splawa-Neymanen en 1923](https://www.jstor.org/stable/2245382), y luego popularizada por [Rubin en 1974](https://www.fsb.muohio.edu/lij14/420_paper_Rubin74.pdf).

La idea central de esta notaci칩n es la **comparaci칩n entre 2 estados del mundo**:

-   **El estado actual:** resultados observados en los datos, considerando el valor real que tom칩 una cierta variable de tratamiento. Por ej: las ventas trimestrales de una empresa, dado que se realiz칩 cierta campa침a de marketing.

-   **El estado contrafactual:** lo que hubiera ocurrido si es que esa variable de tratamiento hubiera tomado un valor distinto. Por ej: las ventas trimestrales de la misma empresa, si es que la campa침a de marketing no se hubiera realizado.

El **efecto causal** de una intervenci칩n (en este caso, de la campa침a de marketing) es la diferencia de la variable de resultados (ventas) entre estos dos estados. Por ende, para calcularlo bastar칤a con restar estos dos valores... algo que en realidad nunca podemos hacer porque **el valor contrafactual es hipot칠tico y desconocido**. Los *contrafactuales* no existen en realidad, ya que al materializarse uno de los escenarios posibles todos los outcomes potenciales desaparecen salvo el "real" o "actual".

En el ejemplo de la empresa, al realizarse la campa침a de marketing ya no es posible observar cu치les hubieran sido las ventas de no haberse realizado la campa침a. Podemos tener conjeturas o hip칩tesis, pero nunca sabremos con certeza cu치l hubiera sido ese valor para esa empresa particular.

La buena noticia es que, teniendo datos de muchas empresas (y cumpli칠ndose ciertas condiciones especiales), podemos igual conseguir una **estimaci칩n** razonable del **efecto *promedio** de una campa침a de marketing gen칠rica sobre ***un conjunto*** de empresas.

Ahora llevemos estos conceptos a la notaci칩n de *Potential Outcomes*.

## Notaci칩n de outcomes potenciales

Primero, se define una variable $D_i$ que representa **si se administra el tratamiento o no** a la unidad $i$[^2]. En el ejemplo de antes, esta variable tomar치 el valor 1 si la empresa $i$ realiza la campa침a de marketing y 0 si no la realiza.

[^2]: Hay casos donde el tratamiento no es binario, pero los dejaremos fuera por ahora en pos de mantener la simplicidad de las explicaciones

Luego se define una variable de resultados $Y_i$, la cual representa **el *outcome* o resultado de inter칠s** para la unidad $i$ (por ejemplo, las ventas).

Esta variable de resultados puede adem치s tener un super칤ndice, que generalmente toma los valores 1 o 0 e indica a qu칠 valor de $D$ est치 asociado el resultado (outcome) en cuesti칩n. En nuestro ejemplo, nos indica si el outcome corresponde a un mundo donde la empresa $i$ llev칩 a cabo la campa침a de marketing ($Y_i^1$) o uno donde no la hizo ($Y_i^0$).

Es importante se침alar que el super칤ndice por s칤 solo ***no*** indica si el outcome es "real" o "contrafactual". Para saber si un outcome es "real" o "contrafactual" necesitamos agregarle una pieza a la expresi칩n:

$$
Y_i^1|D_i=0
$$

Ahora esta se interpreta como "las ventas de la empresa $i$ en el mundo donde s칤 realiza la campa침a de marketing, *condicional a que no realiz칩 la campa침a de marketing en realidad*".

En otras palabras, el super칤ndice denota un escenario hipot칠tico para $Y_i$, y lo que viene despu칠s de $|$ denota lo que ocurri칩 realmente con la unidad $i$. Si estos valores coinciden, estamos frente a un outcome "real", y si son distintos, se trata de un outcome "contrafactual" (y por ende desconocido).

![](images/contrafactuales.jpg){width="750"}

Una forma de resumir lo anterior es la llamada ***switching equation***:

$$
Y_i = D_iY_i^1+(1-D_i)Y_i^0
$$

Que puede entenderse mejor con la ayuda de este meme:

![*Meme ~~robado~~ prestado del libro [Causal Inference for the Brave and True](https://matheusfacure.github.io/python-causality-handbook/01-Introduction-To-Causality.html)*](images/meme_potential_outcomes.jpg){width="400"}

La idea aqu칤 es que en el mundo real observamos s칩lo el outcome real ($Y_i$) que corresponde a la materializaci칩n de uno de los dos outcomes potenciales ($Y_i^1, Y_i^0$) en base al valor tomado por $D_i$: si $D_i=1$, entonces $1-D_i=0$ y la ecuaci칩n colapsa a $Y_i=Y_i^1$ (y viceversa cuando $D_i=0$).

![](images/switching_equation_explicada.png){width="500"}

El outcome potencial no materializado queda relegado a ser el *contrafactual* (i.e. una entelequia de nuestra imaginaci칩n).

Con estos elementos ya podemos tambi칠n definir el **efecto causal** de la campa침a de marketing para la empresa $i$ (la diferencia entre *las ventas si la campa침a se hubiera realizado* y *si no lo hubiera sido*).

$$
\delta_i=Y_i^1-Y_i^0
$$

Como solo conocemos uno de los 2 outcomes potenciales para la unidad $i$, el valor $\delta_i$ es imposible de observar. Adem치s, notar que la presencia del sub칤ndice $i$ implica que el efecto causal puede ser distinto para otras unidades (en general, $\delta_i\ne\delta_j$).

## Efectos promedio: ATE y ATT

Si bien nunca podemos conocer los efectos del tratamiento para cada unidad, bajo ciertas circunstancias podemos estimar efectos causales promedio para un conjunto de unidades.

Existen varios nombres para estos efectos promedio, dependiendo de qu칠 conjunto de unidades se considere. Los m치s relevantes son:

-   [**A**]{.ul}**verage [T]{.ul}reatment [E]{.ul}ffect (ATE):** Corresponde al promedio de los efectos sobre todas las unidades.

$$
\begin{aligned}
ATE &= E[\delta_i]\\
&= E[Y_i^1 - Y_i^0]\\
&= E[Y_i^1]-E[Y_i^0]
\end{aligned}
$$

-   [**A**]{.ul}**verage [T]{.ul}reatment Effect on the [T]{.ul}reated (ATT):** Similar al ATE, pero s칩lo considera las unidades que efectivamente recibieron el tratamiento ($|D_i=1$)[^3].

[^3]: Adem치s existe el ATU (*Average Treatment Effect on the Untreated*), que es an치logo al ATT pero considerando s칩lo las unidades que *no* recibieron el tratamiento. Es menos relevante que el ATE y el ATT y por eso lo menciono solo en una nota al pie.

$$
\begin{aligned}
ATT &= E[\delta_i|D_i=1]\\
&= E[Y_i^1 - Y_i^0|D_i=1]\\
&= E[Y_i^1|D_i=1]-E[Y_i^0|D_i=1]
\end{aligned}
$$

Debemos recordar que, aunque las unidades reciban el tratamiento, aun as칤 poseen conceptualmente un outcome potencial sin tratamiento ($Y_i^0$). Adem치s, como los efectos $\delta_i$ pueden ser diferentes entre unidades (y generalmente lo son), lo m치s probable es que ATE y ATT sean distintos.

Algo problem치tico aqu칤 es que el ATE y el ATT todav칤a son funciones de t칠rminos contrafactuales, y por ende son imposibles de calcular bajo estas expresiones. Pero antes hab칤amos dicho que en ciertas circunstancias era posible estimarlos. 쮺u치les son esas circunstancias?

Para explicarlo debemos introducir una nueva expresi칩n que s칤 puede calcularse: la **diferencia simple de outcomes**.

## Diferencia simple de outcomes

A pesar de la relevancia de los outcomes potenciales, el mundo real los 칰nicos valores que observamos son:

-   Los outcomes reales: $Y_i$

-   Los valores de tratamiento de las unidades: $D_i$

Siguiendo con el ejemplo anterior, esto equivaldr칤a a observar:

-   Las ventas de cada empresa

-   Si realizaron una campa침a de marketing o no durante el periodo analizado

Un estad칤stico f치cil de obtener con estos datos es la diferencia en ventas promedio entre las empresas que realizaron una campa침a de marketing y las que no la hicieron. A este estad칤stico le denominaremos **SDO** (*Simple Difference in Outcomes*), y se expresa as칤 en notaci칩n de outcomes potenciales:

$$
E[Y^1|D=1] - E[Y^0|D=0]
$$

Y se calcula con la siguiente f칩rmula (donde $N_T$ es la cantidad de empresas con $D=1$ y $N_C$ es la cantidad de empresas con $D=0$).

$$
\frac{1}{N_T} \sum_{i=1}^n(yi|d_i=1)-\frac{1}{N_C}\sum_{i=1}^{n}(y_i|d_i=0)
$$

Puede verse que esta expresi칩n **contiene s칩lo outcomes reales** (observables) por lo que **s칤 se puede calcular**.

Ahora bien, intuitivamente sabemos que atribuirle interpretaci칩n causal a esta cifra est치 mal. Por ejemplo, es probable que las empresas con presupuesto suficiente para hacer una campa침a de marketing sean empresas m치s grandes, y por ende fueran a tener ventas mayores aunque no realizaran la campa침a.

Esta intuici칩n se ve reflejada en la **descomposici칩n de la diferencia simple de outcomes**: ![](images/sdo.png)

Lo que nos dice esta descomposici칩n es que el SDO corresponde a la suma de 3 expresiones:

-   Nuestro codiciado **Average Treatment Effect**, el promedio de los efectos causales.

-   Dos sesgos desagradables: el **sesgo de selecci칩n** (diferencia de ventas promedio entre los grupos de empresas si es que ninguna hubiera realizado una campa침a de marketing) y el **sesgo de efectos heterog칠neos** (diferencia de los $\delta_i$ promedio entre empresas que realizaron una campa침a y las que no).

Esta descomposici칩n [est치 demostrada en el libro](https://mixtape.scunning.com/potential-outcomes.html#simple-difference-in-means-decomposition) y es la explicaci칩n "t칠cnica" de porqu칠 el SDO usualmente no tiene interpretaci칩n causal: los sesgos de selecci칩n y de efectos heterog칠neos hacen que el SDO sea distinto del ATE.

La descomposici칩n nos entrega buenas y malas noticias. La buena es que tenemos ahora un estad칤stico f치cil de calcular (el SDO) que t칠cnicamente *contiene* el ATE. La mala es que para "extraer" el ATE desde el SDO necesitamos informaci칩n que en el mundo real no tenemos (los sesgos est치n expresados en t칠rminos de potential outcomes).

La luz de esperanza que nos ofrece la inferencia causal ante esto es desarrollar estrategias para que, en los datos recolectados, los sesgos sean despreciables, y as칤 sea posible usar el SDO como estimador del ATE.

En palabras de [Scott Cunningham](https://www.scunning.com/), autor del libro:

> "One could argue that the entire enterprise of causal inference is about developing a reasonable strategy for negating the role that selection bias is playing in estimated causal effects."

## El supuesto de independencia (y la efectividad de la randomizaci칩n)

OK, sabemos que queremos recuperar efectos promedio, como el ATE y el ATT, y que el SDO *generalmente* no es un buen estimador de ellos debido a los sesgos ya vistos. 쯇ero qu칠 explica la aparici칩n de estos sesgos?

**Los sesgos** (de selecci칩n y de efectos heterog칠neos) **aparecen cuando la asignaci칩n del tratamiento (**$D_i$**) no es independiente de los outcomes potenciales.**

Por ejemplo, cuando decimos algo como "*las empresas con presupuesto suficiente para hacer una campa침a de marketing son m치s grandes, y por ende tendr치n mayores ventas aunque no realicen la campa침a*" lo que estamos queriendo decir, en lenguaje de outcomes potenciales, es que $D$ depende de $Y^0$: empresas con mayor valor de $Y^0$ tienen mayor probabilidad de mostrar un valor $D$ igual a 1.

De lo anterior se desprende que **cuando s칤 existe indepndencia entre la asignaci칩n del tratamiento y los outcomes potenciales (**$(Y^1,Y^0)\mathrel{\unicode{x2AEB}}D$**) el SDO s칤 es un buen estimador del ATE!** (es insesgado)[^4].

[^4]: Pueden encontrar una demostraci칩n de esto en [esta secci칩n](https://mixtape.scunning.com/potential-outcomes.html#independence-assumption) del libro.

![](https://media2.giphy.com/media/G96zgIcQn1L2xpmdxi/giphy.gif)

La mala noticia es que esto rara vez ocurre en el mundo real.

![](https://media2.giphy.com/media/nrg0TI3u0BFw5NBDsQ/giphy.gif)

En general, dondequiera que la variable $D$ sea escogida libremente por seres humanos, habr치 dependencia entre $D$ y los outcomes potenciales 游땻. Si bien las personas no somos [*homo economicus*](https://en.wikipedia.org/wiki/Homo_economicus) que toman sus decisiones con informaci칩n perfecta (no conocemos con exactitud los outcomes potenciales), s칤 recabamos informaci칩n sobre las opciones posibles y sus resultados esperados, y tomamos decisiones que creemos que nos beneficiar치n a partir de esa informaci칩n incompleta. Esto es suficiente para que tales decisiones (i.e. los valores de $D$) no sean independientes de los outcomes potenciales.

En palabras del autor del Mixtape: "*La elecci칩n racional est치 siempre empujando en contra del supuesto de independencia*".

La excepci칩n a esto es la **randomizaci칩n**, justamente porque all칤 no existe elecci칩n libre elecci칩n por parte de agentes. Al asignar los valores de $D$ de forma aleatoria a los participantes de un experimento, imponemos independencia entre estos valores y los outcomes potenciales. Como consecuencia, **la diferencia simple de medias en experimentos aleatorizados suele ser suficiente para estimar efectos causales sin sesgo**.[^5]

[^5]: Digo "suele ser suficiente" (y no "es suficiente) porque a pesar de existir randomizaci칩n, los experimentos a칰n pueden sufrir de otros problemas que introducen sesgo en la estimaci칩n de efectos causales, tales como los [spillovers](https://en.wikipedia.org/wiki/Spillover_(experiment)). Esto queda como tema para otro post en el futuro.

*Tu feedback es bienvenido. Si tienes comentarios sobre este art칤culo puedes envi치rmelos [por correo](mailto:francisco.yira@outlook.com).*