---
title: Modelo de outcomes potenciales (o porqu√© correlaci√≥n no es causalidad)
author: Francisco Yir√°
date: '2021-12-09'
slug: potential-outcomes-causal-inference-mixtape
cover: "images/homer_potential_outcomes.jpg"
useRelativeCover: true
isMath: "true"
categories:
  - libros
  - inferencia-causal
  - data-science
tags:
  - causal-inference-the-mixtape
  - resumenes
  - potential-outcomes
---

<script src="{{< blogdown/postref >}}index.es_files/header-attrs/header-attrs.js"></script>


<p>En este art√≠culo, el segundo de <a href="https://www.franciscoyira.com/es/tags/causal-inference-the-mixtape/">la serie</a> dedicada al libro <a href="https://mixtape.scunning.com/">Causal Inference: The Mixtape</a>, hablar√© sobre <a href="https://mixtape.scunning.com/potential-outcomes.html"><strong>la notaci√≥n de <em>Potential Outcomes</em></strong></a> y de c√≥mo esta nos permite abordar preguntas de causalidad y entender conceptos claves de este campo<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>La idea central de esta notaci√≥n es la <strong>comparaci√≥n entre 2 estados del mundo</strong>:</p>
<ul>
<li><p><strong>El estado actual:</strong> resultados observados en los datos, considerando el valor real que tom√≥ una cierta variable de tratamiento. Por ej: las ventas trimestrales de una empresa, dado que se realiz√≥ cierta campa√±a de marketing.</p></li>
<li><p><strong>El estado contrafactual:</strong> lo que hubiera ocurrido si es que esa variable de tratamiento hubiera tomado un valor distinto. Por ej: las ventas trimestrales de la misma empresa, si es que la campa√±a de marketing no se hubiera realizado.</p></li>
</ul>
<p>El <strong>efecto causal</strong> de una intervenci√≥n (en este caso, de la campa√±a de marketing) es la diferencia de la variable de resultados (ventas) entre estos dos estados. Por ende, para calcularlo bastar√≠a con restar estos dos valores‚Ä¶ algo que en realidad nunca podemos hacer porque <strong>el valor contrafactual es hipot√©tico y desconocido</strong>. Los <em>contrafactuales</em> no existen en realidad, ya que al materializarse uno de los escenarios posibles todos los outcomes potenciales desaparecen salvo el ‚Äúreal‚Äù o ‚Äúactual‚Äù.</p>
<p>En el ejemplo de la empresa, al realizarse la campa√±a de marketing ya no es posible observar cu√°les hubieran sido las ventas de no haberse realizado la campa√±a. Podemos tener conjeturas o hip√≥tesis, pero nunca sabremos con certeza cu√°l hubiera sido ese valor para esa empresa particular.</p>
<p>La buena noticia es que, teniendo datos de muchas empresas (y cumpli√©ndose ciertas condiciones especiales), podemos igual conseguir una <strong>estimaci√≥n</strong> razonable del <strong>efecto <em>promedio<strong> de una campa√±a de marketing gen√©rica sobre </strong></em>un conjunto</strong>* de empresas.</p>
<p>Ahora llevemos estos conceptos a la notaci√≥n de <em>Potential Outcomes</em>.</p>
<div id="notaci√≥n-de-outcomes-potenciales" class="section level2">
<h2>Notaci√≥n de outcomes potenciales</h2>
<p>Primero, se define una variable <span class="math inline">\(D_i\)</span> que representa <strong>si se administra el tratamiento o no</strong> a la unidad <span class="math inline">\(i\)</span><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. En el ejemplo de antes, esta variable tomar√° el valor 1 si la empresa <span class="math inline">\(i\)</span> realiza la campa√±a de marketing y 0 si no la realiza.</p>
<p>Luego se define una variable de resultados <span class="math inline">\(Y_i\)</span>, la cual representa <strong>el <em>outcome</em> o resultado de inter√©s</strong> para la unidad <span class="math inline">\(i\)</span> (por ejemplo, las ventas).</p>
<p>Esta variable de resultados puede adem√°s tener un super√≠ndice, que generalmente toma los valores 1 o 0 e indica a qu√© valor de <span class="math inline">\(D\)</span> est√° asociado el resultado (outcome) en cuesti√≥n. En nuestro ejemplo, nos indica si el outcome corresponde a un mundo donde la empresa <span class="math inline">\(i\)</span> llev√≥ a cabo la campa√±a de marketing (<span class="math inline">\(Y_i^1\)</span>) o uno donde no la hizo (<span class="math inline">\(Y_i^0\)</span>).</p>
<p>Es importante se√±alar que el super√≠ndice por s√≠ solo <strong><em>no</em></strong> indica si el outcome es ‚Äúreal‚Äù o ‚Äúcontrafactual‚Äù. Para saber si un outcome es ‚Äúreal‚Äù o ‚Äúcontrafactual‚Äù necesitamos agregarle una pieza a la expresi√≥n:</p>
<p><span class="math display">\[
Y_i^1|D_i=0
\]</span></p>
<p>Ahora esta se interpreta como ‚Äúlas ventas de la empresa <span class="math inline">\(i\)</span> en el mundo donde s√≠ realiza la campa√±a de marketing, <em>condicional a que no realiz√≥ la campa√±a de marketing en realidad</em>‚Äù.</p>
<p>En otras palabras, el super√≠ndice denota un escenario hipot√©tico para <span class="math inline">\(Y_i\)</span>, y lo que viene despu√©s de <span class="math inline">\(|\)</span> denota lo que ocurri√≥ realmente con la unidad <span class="math inline">\(i\)</span>. Si estos valores coinciden, estamos frente a un outcome ‚Äúreal‚Äù, y si son distintos, se trata de un outcome ‚Äúcontrafactual‚Äù (y por ende desconocido).</p>
<p><img src="images/contrafactuales.jpg" width="750" /></p>
<p>Una forma de resumir lo anterior es la llamada <strong><em>switching equation</em></strong>:</p>
<p><span class="math display">\[
Y_i = D_iY_i^1+(1-D_i)Y_i^0
\]</span></p>
<p>Que puede entenderse mejor con la ayuda de este meme:</p>
<div class="figure">
<img src="images/meme_potential_outcomes.jpg" width="400" alt="" />
<p class="caption"><em>Meme <del>robado</del> prestado del libro <a href="https://matheusfacure.github.io/python-causality-handbook/01-Introduction-To-Causality.html">Causal Inference for the Brave and True</a></em></p>
</div>
<p>La idea aqu√≠ es que en el mundo real observamos s√≥lo el outcome real (<span class="math inline">\(Y_i\)</span>) que corresponde a la materializaci√≥n de uno de los dos outcomes potenciales (<span class="math inline">\(Y_i^1, Y_i^0\)</span>) en base al valor tomado por <span class="math inline">\(D_i\)</span>: si <span class="math inline">\(D_i=1\)</span>, entonces <span class="math inline">\(1-D_i=0\)</span> y la ecuaci√≥n colapsa a <span class="math inline">\(Y_i=Y_i^1\)</span> (y viceversa cuando <span class="math inline">\(D_i=0\)</span>).</p>
<p><img src="images/switching_equation_explicada.png" width="500" /></p>
<p>El outcome potencial no materializado queda relegado a ser el <em>contrafactual</em> (i.e.¬†una entelequia de nuestra imaginaci√≥n).</p>
<p>Con estos elementos ya podemos tambi√©n definir el <strong>efecto causal</strong> de la campa√±a de marketing para la empresa <span class="math inline">\(i\)</span> (la diferencia entre <em>las ventas si la campa√±a se hubiera realizado</em> y <em>si no lo hubiera sido</em>).</p>
<p><span class="math display">\[
\delta_i=Y_i^1-Y_i^0
\]</span></p>
<p>Como solo conocemos uno de los 2 outcomes potenciales para la unidad <span class="math inline">\(i\)</span>, el valor <span class="math inline">\(\delta_i\)</span> es imposible de observar. Adem√°s, notar que la presencia del sub√≠ndice <span class="math inline">\(i\)</span> implica que el efecto causal puede ser distinto para otras unidades (en general, <span class="math inline">\(\delta_i\ne\delta_j\)</span>).</p>
</div>
<div id="efectos-promedio-ate-y-att" class="section level2">
<h2>Efectos promedio: ATE y ATT</h2>
<p>Si bien nunca podemos conocer los efectos del tratamiento para cada unidad, bajo ciertas circunstancias podemos estimar efectos causales promedio para un conjunto de unidades.</p>
<p>Existen varios nombres para estos efectos promedio, dependiendo de qu√© conjunto de unidades se considere. Los m√°s relevantes son:</p>
<ul>
<li><u><strong>A</strong></u><strong>verage <u>T</u>reatment <u>E</u>ffect (ATE):</strong> Corresponde al promedio de los efectos sobre todas las unidades.</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
ATE &amp;= E[\delta_i]\\
&amp;= E[Y_i^1 - Y_i^0]\\
&amp;= E[Y_i^1]-E[Y_i^0]
\end{aligned}
\]</span></p>
<ul>
<li><u><strong>A</strong></u><strong>verage <u>T</u>reatment Effect on the <u>T</u>reated (ATT):</strong> Similar al ATE, pero s√≥lo considera las unidades que efectivamente recibieron el tratamiento (<span class="math inline">\(|D_i=1\)</span>)<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
ATT &amp;= E[\delta_i|D_i=1]\\
&amp;= E[Y_i^1 - Y_i^0|D_i=1]\\
&amp;= E[Y_i^1|D_i=1]-E[Y_i^0|D_i=1]
\end{aligned}
\]</span></p>
<p>Debemos recordar que, aunque las unidades reciban el tratamiento, aun as√≠ poseen conceptualmente un outcome potencial sin tratamiento (<span class="math inline">\(Y_i^0\)</span>). Adem√°s, como los efectos <span class="math inline">\(\delta_i\)</span> pueden ser diferentes entre unidades (y generalmente lo son), lo m√°s probable es que ATE y ATT sean distintos.</p>
<p>Algo problem√°tico aqu√≠ es que el ATE y el ATT todav√≠a son funciones de t√©rminos contrafactuales, y por ende son imposibles de calcular bajo estas expresiones. Pero antes hab√≠amos dicho que en ciertas circunstancias era posible estimarlos. ¬øCu√°les son esas circunstancias?</p>
<p>Para explicarlo debemos introducir una nueva expresi√≥n que s√≠ puede calcularse: la <strong>diferencia simple de outcomes</strong>.</p>
</div>
<div id="diferencia-simple-de-outcomes" class="section level2">
<h2>Diferencia simple de outcomes</h2>
<p>A pesar de la relevancia de los outcomes potenciales, el mundo real los √∫nicos valores que observamos son:</p>
<ul>
<li><p>Los outcomes reales: <span class="math inline">\(Y_i\)</span></p></li>
<li><p>Los valores de tratamiento de las unidades: <span class="math inline">\(D_i\)</span></p></li>
</ul>
<p>Siguiendo con el ejemplo anterior, esto equivaldr√≠a a observar:</p>
<ul>
<li><p>Las ventas de cada empresa</p></li>
<li><p>Si realizaron una campa√±a de marketing o no durante el periodo analizado</p></li>
</ul>
<p>Un estad√≠stico f√°cil de obtener con estos datos es la diferencia en ventas promedio entre las empresas que realizaron una campa√±a de marketing y las que no la hicieron. A este estad√≠stico le denominaremos <strong>SDO</strong> (<em>Simple Difference in Outcomes</em>), y se expresa as√≠ en notaci√≥n de outcomes potenciales:</p>
<p><span class="math display">\[
E[Y^1|D=1] - E[Y^0|D=0]
\]</span></p>
<p>Y se calcula con la siguiente f√≥rmula (donde <span class="math inline">\(N_T\)</span> es la cantidad de empresas con <span class="math inline">\(D=1\)</span> y <span class="math inline">\(N_C\)</span> es la cantidad de empresas con <span class="math inline">\(D=0\)</span>).</p>
<p><span class="math display">\[
\frac{1}{N_T} \sum_{i=1}^n(yi|d_i=1)-\frac{1}{N_C}\sum_{i=1}^{n}(y_i|d_i=0)
\]</span></p>
<p>Puede verse que esta expresi√≥n <strong>contiene s√≥lo outcomes reales</strong> (observables) por lo que <strong>s√≠ se puede calcular</strong>.</p>
<p>Ahora bien, intuitivamente sabemos que atribuirle interpretaci√≥n causal a esta cifra est√° mal. Por ejemplo, es probable que las empresas con presupuesto suficiente para hacer una campa√±a de marketing sean empresas m√°s grandes, y por ende fueran a tener ventas mayores aunque no realizaran la campa√±a.</p>
<p>Esta intuici√≥n se ve reflejada en la <strong>descomposici√≥n de la diferencia simple de outcomes</strong>: <img src="images/sdo.png" /></p>
<p>Lo que nos dice esta descomposici√≥n es que el SDO corresponde a la suma de 3 expresiones:</p>
<ul>
<li><p>Nuestro codiciado <strong>Average Treatment Effect</strong>, el promedio de los efectos causales.</p></li>
<li><p>Dos sesgos desagradables: el <strong>sesgo de selecci√≥n</strong> (diferencia de ventas promedio entre los grupos de empresas si es que ninguna hubiera realizado una campa√±a de marketing) y el <strong>sesgo de efectos heterog√©neos</strong> (diferencia de los <span class="math inline">\(\delta_i\)</span> promedio entre empresas que realizaron una campa√±a y las que no).</p></li>
</ul>
<p>Esta descomposici√≥n <a href="https://mixtape.scunning.com/potential-outcomes.html#simple-difference-in-means-decomposition">est√° demostrada en el libro</a> y es la explicaci√≥n ‚Äút√©cnica‚Äù de porqu√© el SDO usualmente no tiene interpretaci√≥n causal: los sesgos de selecci√≥n y de efectos heterog√©neos hacen que el SDO sea distinto del ATE.</p>
<p>La descomposici√≥n nos entrega buenas y malas noticias. La buena es que tenemos ahora un estad√≠stico f√°cil de calcular (el SDO) que t√©cnicamente <em>contiene</em> el ATE. La mala es que para ‚Äúextraer‚Äù el ATE desde el SDO necesitamos informaci√≥n que en el mundo real no tenemos (los sesgos est√°n expresados en t√©rminos de potential outcomes).</p>
<p>La luz de esperanza que nos ofrece la inferencia causal ante esto es desarrollar estrategias para que, en los datos recolectados, los sesgos sean despreciables, y as√≠ sea posible usar el SDO como estimador del ATE.</p>
<p>En palabras de <a href="https://www.scunning.com/">Scott Cunningham</a>, autor del libro:</p>
<blockquote>
<p>‚ÄúOne could argue that the entire enterprise of causal inference is about developing a reasonable strategy for negating the role that selection bias is playing in estimated causal effects.‚Äù</p>
</blockquote>
</div>
<div id="el-supuesto-de-independencia-y-la-efectividad-de-la-randomizaci√≥n" class="section level2">
<h2>El supuesto de independencia (y la efectividad de la randomizaci√≥n)</h2>
<p>OK, sabemos que queremos recuperar efectos promedio, como el ATE y el ATT, y que el SDO <em>generalmente</em> no es un buen estimador de ellos debido a los sesgos ya vistos. ¬øPero qu√© explica la aparici√≥n de estos sesgos?</p>
<p><strong>Los sesgos</strong> (de selecci√≥n y de efectos heterog√©neos) <strong>aparecen cuando la asignaci√≥n del tratamiento (</strong><span class="math inline">\(D_i\)</span><strong>) no es independiente de los outcomes potenciales.</strong></p>
<p>Por ejemplo, cuando decimos algo como ‚Äú<em>las empresas con presupuesto suficiente para hacer una campa√±a de marketing son m√°s grandes, y por ende tendr√°n mayores ventas aunque no realicen la campa√±a</em>‚Äù lo que estamos queriendo decir, en lenguaje de outcomes potenciales, es que <span class="math inline">\(D\)</span> depende de <span class="math inline">\(Y^0\)</span>: empresas con mayor valor de <span class="math inline">\(Y^0\)</span> tienen mayor probabilidad de mostrar un valor <span class="math inline">\(D\)</span> igual a 1.</p>
<p>De lo anterior se desprende que <strong>cuando s√≠ existe indepndencia entre la asignaci√≥n del tratamiento y los outcomes potenciales (</strong><span class="math inline">\((Y^1,Y^0)\mathrel{\unicode{x2AEB}}D\)</span><strong>) el SDO s√≠ es un buen estimador del ATE!</strong> (es insesgado)<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p><img src="https://media2.giphy.com/media/G96zgIcQn1L2xpmdxi/giphy.gif" /></p>
<p>La mala noticia es que esto rara vez ocurre en el mundo real.</p>
<p><img src="https://media2.giphy.com/media/nrg0TI3u0BFw5NBDsQ/giphy.gif" /></p>
<p>En general, dondequiera que la variable <span class="math inline">\(D\)</span> sea escogida libremente por seres humanos, habr√° dependencia entre <span class="math inline">\(D\)</span> y los outcomes potenciales üòµ. Si bien las personas no somos <a href="https://en.wikipedia.org/wiki/Homo_economicus"><em>homo economicus</em></a> que toman sus decisiones con informaci√≥n perfecta (no conocemos con exactitud los outcomes potenciales), s√≠ recabamos informaci√≥n sobre las opciones posibles y sus resultados esperados, y tomamos decisiones que creemos que nos beneficiar√°n a partir de esa informaci√≥n incompleta. Esto es suficiente para que tales decisiones (i.e.¬†los valores de <span class="math inline">\(D\)</span>) no sean independientes de los outcomes potenciales.</p>
<p>En palabras del autor del Mixtape: ‚Äú<em>La elecci√≥n racional est√° siempre empujando en contra del supuesto de independencia</em>‚Äù.</p>
<p>La excepci√≥n a esto es la <strong>randomizaci√≥n</strong>, justamente porque all√≠ no existe elecci√≥n libre elecci√≥n por parte de agentes. Al asignar los valores de <span class="math inline">\(D\)</span> de forma aleatoria a los participantes de un experimento, imponemos independencia entre estos valores y los outcomes potenciales. Como consecuencia, <strong>la diferencia simple de medias en experimentos aleatorizados suele ser suficiente para estimar efectos causales sin sesgo</strong>.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p><em>Tu feedback es bienvenido. Si tienes comentarios sobre este art√≠culo puedes envi√°rmelos <a href="mailto:francisco.yira@outlook.com">por correo</a>.</em></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>La notaci√≥n de Potential Outcomes fue concebida primero por <a href="https://www.jstor.org/stable/2245382">Splawa-Neymanen en 1923</a>, y luego popularizada por <a href="https://www.fsb.muohio.edu/lij14/420_paper_Rubin74.pdf">Rubin en 1974</a>.<a href="#fnref1" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Hay casos donde el tratamiento no es binario, pero los dejaremos fuera por ahora en pos de mantener la simplicidad de las explicaciones<a href="#fnref2" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>Adem√°s existe el ATU (<em>Average Treatment Effect on the Untreated</em>), que es an√°logo al ATT pero considerando s√≥lo las unidades que <em>no</em> recibieron el tratamiento. Es menos relevante que el ATE y el ATT y por eso lo menciono solo en una nota al pie.<a href="#fnref3" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>Pueden encontrar una demostraci√≥n de esto en <a href="https://mixtape.scunning.com/potential-outcomes.html#independence-assumption">esta secci√≥n</a> del libro.<a href="#fnref4" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn5"><p>Digo ‚Äúsuele ser suficiente‚Äù (y no "es suficiente) porque a pesar de existir randomizaci√≥n, los experimentos a√∫n pueden sufrir de otros problemas que introducen sesgo en la estimaci√≥n de efectos causales, tales como los <a href="https://en.wikipedia.org/wiki/Spillover_(experiment)">spillovers</a>. Esto queda como tema para otro post en el futuro.<a href="#fnref5" class="footnote-back">‚Ü©Ô∏é</a></p></li>
</ol>
</div>
